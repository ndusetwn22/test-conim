{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/* global: window */\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\n\nvar classnames_1 = __importDefault(require(\"classnames\"));\n\nvar cloneItem_1 = require(\"./cloneItem\");\n\nvar Portal_1 = require(\"./Portal\");\n\nvar actions_1 = require(\"../utils/actions\");\n\nvar styles_1 = require(\"../utils/styles\");\n\nvar eventManager_1 = require(\"../utils/eventManager\");\n\nvar KEY = {\n  ENTER: 13,\n  ESC: 27,\n  ARROW_UP: 38,\n  ARROW_DOWN: 40,\n  ARROW_LEFT: 37,\n  ARROW_RIGHT: 39\n};\n\nvar Menu =\n/** @class */\nfunction (_super) {\n  __extends(Menu, _super);\n\n  function Menu() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      x: 0,\n      y: 0,\n      visible: false,\n      nativeEvent: {},\n      propsFromTrigger: {},\n      onShown: null,\n      onHidden: null\n    };\n    _this.unsub = [];\n\n    _this.bindWindowEvent = function () {\n      window.addEventListener('resize', _this.hide);\n      window.addEventListener('contextmenu', _this.hide);\n      window.addEventListener('mousedown', _this.hide);\n      window.addEventListener('click', _this.hide);\n      window.addEventListener('scroll', _this.hide);\n      window.addEventListener('keydown', _this.handleKeyboard);\n    };\n\n    _this.unBindWindowEvent = function () {\n      window.removeEventListener('resize', _this.hide);\n      window.removeEventListener('contextmenu', _this.hide);\n      window.removeEventListener('mousedown', _this.hide);\n      window.removeEventListener('click', _this.hide);\n      window.removeEventListener('scroll', _this.hide);\n      window.removeEventListener('keydown', _this.handleKeyboard);\n    };\n\n    _this.onMouseEnter = function () {\n      return window.removeEventListener('mousedown', _this.hide);\n    };\n\n    _this.onMouseLeave = function () {\n      return window.addEventListener('mousedown', _this.hide);\n    };\n\n    _this.hide = function (event) {\n      // Safari trigger a click event when you ctrl + trackpad\n      // Firefox:  trigger a click event when right click occur\n      var e = event;\n\n      if (typeof e !== 'undefined' && (e.button === 2 || e.ctrlKey === true) && e.type !== 'contextmenu') {\n        return;\n      }\n\n      _this.unBindWindowEvent();\n\n      _this.setState({\n        visible: false\n      });\n    };\n\n    _this.handleKeyboard = function (e) {\n      if (e.keyCode === KEY.ENTER || e.keyCode === KEY.ESC) {\n        _this.unBindWindowEvent();\n\n        _this.setState({\n          visible: false\n        });\n      }\n    };\n\n    _this.setRef = function (ref) {\n      _this.menuRef = ref;\n    };\n\n    _this.show = function (e, props) {\n      e.stopPropagation();\n      eventManager_1.eventManager.emit(actions_1.HIDE_ALL);\n\n      var _a = _this.getMousePosition(e),\n          x = _a.x,\n          y = _a.y;\n\n      _this.setState({\n        visible: true,\n        x: x,\n        y: y,\n        nativeEvent: e,\n        propsFromTrigger: props\n      }, _this.setMenuPosition);\n    };\n\n    return _this;\n  }\n\n  Menu.prototype.componentDidMount = function () {\n    this.unsub.push(eventManager_1.eventManager.on(actions_1.DISPLAY_MENU(this.props.id), this.show));\n    this.unsub.push(eventManager_1.eventManager.on(actions_1.HIDE_ALL, this.hide));\n  };\n\n  Menu.prototype.componentWillUnmount = function () {\n    this.unsub.forEach(function (cb) {\n      return cb();\n    });\n    this.unBindWindowEvent();\n  };\n\n  Menu.prototype.componentDidUpdate = function (_, prevState) {\n    if (this.state.visible !== prevState.visible) {\n      if (this.state.visible && this.props.onShown) {\n        this.props.onShown();\n      } else if (!this.state.visible && this.props.onHidden) {\n        this.props.onHidden();\n      }\n    }\n  };\n\n  Menu.prototype.setMenuPosition = function () {\n    var windowWidth = window.innerWidth,\n        windowHeight = window.innerHeight;\n    var _a = this.menuRef,\n        menuWidth = _a.offsetWidth,\n        menuHeight = _a.offsetHeight;\n    var _b = this.state,\n        x = _b.x,\n        y = _b.y;\n\n    if (x + menuWidth > windowWidth) {\n      x -= x + menuWidth - windowWidth;\n    }\n\n    if (y + menuHeight > windowHeight) {\n      y -= y + menuHeight - windowHeight;\n    }\n\n    this.setState({\n      x: x,\n      y: y\n    }, this.bindWindowEvent);\n  };\n\n  Menu.prototype.getMousePosition = function (e) {\n    var pos = {\n      x: e.clientX,\n      y: e.clientY\n    };\n\n    if (e.type === 'touchend' && (!pos.x || !pos.y) && e.changedTouches && e.changedTouches.length > 0) {\n      pos.x = e.changedTouches[0].clientX;\n      pos.y = e.changedTouches[0].clientY;\n    }\n\n    if (!pos.x || pos.x < 0) {\n      pos.x = 0;\n    }\n\n    if (!pos.y || pos.y < 0) {\n      pos.y = 0;\n    }\n\n    return pos;\n  };\n\n  Menu.prototype.render = function () {\n    var _a;\n\n    var _b = this.props,\n        theme = _b.theme,\n        animation = _b.animation,\n        style = _b.style,\n        className = _b.className,\n        children = _b.children;\n    var _c = this.state,\n        visible = _c.visible,\n        nativeEvent = _c.nativeEvent,\n        propsFromTrigger = _c.propsFromTrigger,\n        x = _c.x,\n        y = _c.y;\n    var cssClasses = classnames_1.default(styles_1.styles.menu, className, (_a = {}, _a[styles_1.styles.theme + theme] = theme, _a[styles_1.styles.animationWillEnter + animation] = animation, _a));\n\n    var menuStyle = __assign({}, style, {\n      left: x,\n      top: y + 1,\n      opacity: 1\n    });\n\n    return react_1.default.createElement(Portal_1.Portal, null, visible && react_1.default.createElement(\"div\", {\n      className: cssClasses,\n      style: menuStyle,\n      ref: this.setRef,\n      onMouseEnter: this.onMouseEnter,\n      onMouseLeave: this.onMouseLeave\n    }, react_1.default.createElement(\"div\", null, cloneItem_1.cloneItem(children, {\n      nativeEvent: nativeEvent,\n      propsFromTrigger: propsFromTrigger\n    }))));\n  };\n\n  Menu.propTypes = {\n    id: prop_types_1.default.oneOfType([prop_types_1.default.string, prop_types_1.default.number]).isRequired,\n    children: prop_types_1.default.node.isRequired,\n    theme: prop_types_1.default.string,\n    animation: prop_types_1.default.string,\n    className: prop_types_1.default.string,\n    style: prop_types_1.default.object\n  };\n  return Menu;\n}(react_1.Component);\n\nexports.Menu = Menu;","map":{"version":3,"sources":["../../src/components/Menu.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/* global: window */\nvar react_1 = __importStar(require(\"react\"));\nvar prop_types_1 = __importDefault(require(\"prop-types\"));\nvar classnames_1 = __importDefault(require(\"classnames\"));\nvar cloneItem_1 = require(\"./cloneItem\");\nvar Portal_1 = require(\"./Portal\");\nvar actions_1 = require(\"../utils/actions\");\nvar styles_1 = require(\"../utils/styles\");\nvar eventManager_1 = require(\"../utils/eventManager\");\nvar KEY = {\n    ENTER: 13,\n    ESC: 27,\n    ARROW_UP: 38,\n    ARROW_DOWN: 40,\n    ARROW_LEFT: 37,\n    ARROW_RIGHT: 39\n};\nvar Menu = /** @class */ (function (_super) {\n    __extends(Menu, _super);\n    function Menu() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = {\n            x: 0,\n            y: 0,\n            visible: false,\n            nativeEvent: {},\n            propsFromTrigger: {},\n            onShown: null,\n            onHidden: null\n        };\n        _this.unsub = [];\n        _this.bindWindowEvent = function () {\n            window.addEventListener('resize', _this.hide);\n            window.addEventListener('contextmenu', _this.hide);\n            window.addEventListener('mousedown', _this.hide);\n            window.addEventListener('click', _this.hide);\n            window.addEventListener('scroll', _this.hide);\n            window.addEventListener('keydown', _this.handleKeyboard);\n        };\n        _this.unBindWindowEvent = function () {\n            window.removeEventListener('resize', _this.hide);\n            window.removeEventListener('contextmenu', _this.hide);\n            window.removeEventListener('mousedown', _this.hide);\n            window.removeEventListener('click', _this.hide);\n            window.removeEventListener('scroll', _this.hide);\n            window.removeEventListener('keydown', _this.handleKeyboard);\n        };\n        _this.onMouseEnter = function () { return window.removeEventListener('mousedown', _this.hide); };\n        _this.onMouseLeave = function () { return window.addEventListener('mousedown', _this.hide); };\n        _this.hide = function (event) {\n            // Safari trigger a click event when you ctrl + trackpad\n            // Firefox:  trigger a click event when right click occur\n            var e = event;\n            if (typeof e !== 'undefined' &&\n                (e.button === 2 || e.ctrlKey === true) &&\n                e.type !== 'contextmenu') {\n                return;\n            }\n            _this.unBindWindowEvent();\n            _this.setState({ visible: false });\n        };\n        _this.handleKeyboard = function (e) {\n            if (e.keyCode === KEY.ENTER || e.keyCode === KEY.ESC) {\n                _this.unBindWindowEvent();\n                _this.setState({ visible: false });\n            }\n        };\n        _this.setRef = function (ref) {\n            _this.menuRef = ref;\n        };\n        _this.show = function (e, props) {\n            e.stopPropagation();\n            eventManager_1.eventManager.emit(actions_1.HIDE_ALL);\n            var _a = _this.getMousePosition(e), x = _a.x, y = _a.y;\n            _this.setState({\n                visible: true,\n                x: x,\n                y: y,\n                nativeEvent: e,\n                propsFromTrigger: props\n            }, _this.setMenuPosition);\n        };\n        return _this;\n    }\n    Menu.prototype.componentDidMount = function () {\n        this.unsub.push(eventManager_1.eventManager.on(actions_1.DISPLAY_MENU(this.props.id), this.show));\n        this.unsub.push(eventManager_1.eventManager.on(actions_1.HIDE_ALL, this.hide));\n    };\n    Menu.prototype.componentWillUnmount = function () {\n        this.unsub.forEach(function (cb) { return cb(); });\n        this.unBindWindowEvent();\n    };\n    Menu.prototype.componentDidUpdate = function (_, prevState) {\n        if (this.state.visible !== prevState.visible) {\n            if (this.state.visible && this.props.onShown) {\n                this.props.onShown();\n            }\n            else if (!this.state.visible && this.props.onHidden) {\n                this.props.onHidden();\n            }\n        }\n    };\n    Menu.prototype.setMenuPosition = function () {\n        var windowWidth = window.innerWidth, windowHeight = window.innerHeight;\n        var _a = this.menuRef, menuWidth = _a.offsetWidth, menuHeight = _a.offsetHeight;\n        var _b = this.state, x = _b.x, y = _b.y;\n        if (x + menuWidth > windowWidth) {\n            x -= x + menuWidth - windowWidth;\n        }\n        if (y + menuHeight > windowHeight) {\n            y -= y + menuHeight - windowHeight;\n        }\n        this.setState({\n            x: x,\n            y: y\n        }, this.bindWindowEvent);\n    };\n    Menu.prototype.getMousePosition = function (e) {\n        var pos = {\n            x: e.clientX,\n            y: e.clientY\n        };\n        if (e.type === 'touchend' &&\n            (!pos.x || !pos.y) &&\n            (e.changedTouches && e.changedTouches.length > 0)) {\n            pos.x = e.changedTouches[0].clientX;\n            pos.y = e.changedTouches[0].clientY;\n        }\n        if (!pos.x || pos.x < 0) {\n            pos.x = 0;\n        }\n        if (!pos.y || pos.y < 0) {\n            pos.y = 0;\n        }\n        return pos;\n    };\n    Menu.prototype.render = function () {\n        var _a;\n        var _b = this.props, theme = _b.theme, animation = _b.animation, style = _b.style, className = _b.className, children = _b.children;\n        var _c = this.state, visible = _c.visible, nativeEvent = _c.nativeEvent, propsFromTrigger = _c.propsFromTrigger, x = _c.x, y = _c.y;\n        var cssClasses = classnames_1.default(styles_1.styles.menu, className, (_a = {},\n            _a[styles_1.styles.theme + theme] = theme,\n            _a[styles_1.styles.animationWillEnter + animation] = animation,\n            _a));\n        var menuStyle = __assign({}, style, { left: x, top: y + 1, opacity: 1 });\n        return (react_1.default.createElement(Portal_1.Portal, null, visible && (react_1.default.createElement(\"div\", { className: cssClasses, style: menuStyle, ref: this.setRef, onMouseEnter: this.onMouseEnter, onMouseLeave: this.onMouseLeave },\n            react_1.default.createElement(\"div\", null, cloneItem_1.cloneItem(children, {\n                nativeEvent: nativeEvent,\n                propsFromTrigger: propsFromTrigger\n            }))))));\n    };\n    Menu.propTypes = {\n        id: prop_types_1.default.oneOfType([prop_types_1.default.string, prop_types_1.default.number]).isRequired,\n        children: prop_types_1.default.node.isRequired,\n        theme: prop_types_1.default.string,\n        animation: prop_types_1.default.string,\n        className: prop_types_1.default.string,\n        style: prop_types_1.default.object\n    };\n    return Menu;\n}(react_1.Component));\nexports.Menu = Menu;\n//# sourceMappingURL=Menu.js.map"]},"metadata":{},"sourceType":"script"}